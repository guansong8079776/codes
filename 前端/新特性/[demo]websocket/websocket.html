<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>websocket测试</title>
</head>
<body>

    <div id="message">
        连接打开后，你可以向服务器发送：<ul><li>你好</li><li>天王盖地虎</li><li>今天天气</li></ul>这三条消息，服务器会自动答复，如果超过1分钟不进行任何操作，服务器会断开socket连接<br/>
    </div>
    <hr/>
    <label>发送消息：<input type="text" id="txtmsg"><input type="button" value="send" id="btnsend"></label>

    <script>
        // 打开一个 web socket
        var ws = new WebSocket("wss://guansir.com.cn/ws");
        /**
         * 服务器连接完成事件，在连接成功后就可以调用send方法发送数据到服务器了
         */
        ws.onopen = function()
        {
            showMessage("服务器已连接，等待数据发送。。。");
        };
        /**
         * 接收消息事件，服务器每次发送数据，都将触发此事件
         * @param evt 包含消息的 MessageEvent 对象
         */
        ws.onmessage = function (evt)
        {
            console.log(evt);
            var received_msg = evt.data;
            showMessage("接收消息：" + evt.data);
        };

        ws.onclose = function()
        {
            // 关闭 websocket
           showMessage("连接已关闭！");
        };

        //点击发送按钮的事件处理函数
        btnsend.onclick = function(){
            console.log(ws.readyState);
            sendMessage(txtmsg.value);
        }
        //发送消息的方法，在点击 send 按钮时可以调用
        function  sendMessage(msg){
            ws.send(msg);
            message.innerHTML += "发送消息：" + msg + "<br/>";
        }

        //将收发的消息显示在 div 中
        function  showMessage(msg){
            message.innerHTML +=  msg + "<br/>";
        }
    </script>
    WebSocket 协议本质上是一个基于 TCP 的协议。
    为了建立一个 WebSocket 连接，客户端浏览器首先要向服务器发起一个 HTTP 请求，这个请求和通常的 HTTP 请求不同，包含了一些附加头信息，其中附加头信息"Upgrade: WebSocket"表明这是一个申请协议升级的 HTTP 请求，服务器端解析这些附加的头信息然后产生应答信息返回给客户端，客户端和服务器端的 WebSocket 连接就建立起来了，双方就可以通过这个连接通道自由的传递信息，并且这个连接会持续存在直到客户端或者服务器端的某一方主动的关闭连接。
    <br/>
下面为WebSocket的所有属性、方法、变量
<pre>
    /**
@static
@type {number}
@const
*/
WebSocket.CONNECTING = 0;
/**
@static 状态值 （readstate）
@type {number}1 为已打开状态
@const
*/
WebSocket.OPEN = 1;
/**
@static
@type {number} 正在关闭
@const
*/
WebSocket.CLOSING = 2;
/**
@static
@type {number} 已关闭
@const
*/
WebSocket.CLOSED = 3;
/**
@type {string} 请求路径
*/
WebSocket.prototype.url = null;
/**
@type {number} 起始值为0，open 为1，closed为3
@const
*/
WebSocket.prototype.readyState = 0;
/**
@type {number} 只读属性 bufferedAmount 已被 send() 放入正在队列中等待传输，但是还没有发出的 UTF-8 文本字节数。
@const
*/
WebSocket.prototype.bufferedAmount = 0;
/**
@type {string}
@const
*/
WebSocket.prototype.extensions = null;
/**
@type {string}
@const
*/
WebSocket.prototype.protocol = null;
/**
@type {function(Event)}
*/
WebSocket.prototype.onopen = 0;
/**
@type {function({data: (String|Blob|ArrayBuffer)})}
*/
WebSocket.prototype.onmessage = 0;
/**
@type {function(Event)}
*/
WebSocket.prototype.onerror = 0;
/**
@type {function({code: Number, reason: String, wasClean: Boolean})}
*/
WebSocket.prototype.onclose = 0;
/**
@param {string} url 连接地址
@param {...string} protocols 握手的协议
@constructor
*/
function WebSocket(url,protocols) {}
/**
@param {String|ArrayBuffer|ArrayBufferView|Blob} data
*/
WebSocket.prototype.send = function(data) {};
/**
@param {number} [code]
@param {string} [reason]
*/
WebSocket.prototype.close = function(code,reason) {};
    </pre>
</body>
</html>